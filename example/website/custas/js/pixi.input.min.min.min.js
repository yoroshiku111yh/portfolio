(function(h){var n=PIXI.VERSION.indexOf("v1")!==-1;var o=navigator&&navigator.isCocoonJS;var s=(typeof window.orientation!=="undefined");var q=300;function f(){}var r={readonly:false,maxlength:null,placeholder:"",placeholderColor:"#bfbebd",placeholderAlign:"",selectionColor:"rgba(179, 212, 253, 0.8)",selectionUpdated:false,selectionStart:-1,value:"",type:"text",onsubmit:f,onkeydown:f,onkeyup:f,onfocus:f,onblur:f,onmousedown:f,onmouseup:f,cursorPos:0,hasFocus:false,mouseDown:false};var t={width:170,height:null,padding:5,borderColor:"#000",borderWidth:1,borderRadius:3,backgroundImage:null,backgroundColor:"#fff",backgroundGradient:null,boxShadow:"1px 1px 0px rgba(0, 0, 0, 0.1)",innerShadow:"0px 0px 4px rgba(0, 0, 0, 0.4)",valign:"middle",align:"center",outline:0,text:{font:"14px Arial",fill:"#000",align:"left",stroke:"#000",strokeThickness:0}};function d(w){if(w.value!==h){return"value"}if(w.text!==h){return"text"}if(w.textContent!==h){return"textContent"}return"innerText"}function u(w,y,x){w[y]=x}function c(w,x){return w[x].replace(/\r/g,"")}function m(w){return typeof w==="object"&&!!w&&!(w instanceof Array)}var e={};function p(x){var z=e[x];if(!z){var y=document.createElement("canvas");y.width=2;y.height=2;var w=y.getContext("2d");w.fillStyle=x;w.fillRect(0,0,2,2);z=PIXI.Texture.fromCanvas(y);e[x]=z}return z}function i(w,z,y){for(var x in z){if(y){w[x]=z[x];continue}var A=m(z[x]);if(!w.hasOwnProperty(x)){w[x]=A?{}:z[x]}if(A){if(!m(w[x])){w[x]={}}i(w[x],z[x])}}return w}function v(w){if(w._isBitmapFont){return w._lineHeight}if(n||w.determineFontHeight){return w.determineFontHeight("font: "+w.style.font+";")+w.style.strokeThickness}else{return parseInt(w.determineFontProperties(w.style.font).fontSize,10)+w.style.strokeThickness}}function k(A,y,x,z,w,B){if(B instanceof Array){var F=B[0],E=B[1],D=B[2],C=B[3]}else{var F=B,E=B,D=B,C=B}if(z<2*F||w<2*F){return k(A,y,x,z||1,w||1,0)}A.beginPath();A.moveTo(y+F,x);A.lineTo(y+z-E,x);A.quadraticCurveTo(y+z,x,y+z,x+E);A.lineTo(y+z,x+w-D);A.quadraticCurveTo(y+z,x+w,y+z-D,x+w);A.lineTo(y+C,x+w);A.quadraticCurveTo(y,x+w,y,x+w-C);A.lineTo(y,x+F);A.quadraticCurveTo(y,x,y+F,x);A.closePath()}function b(w,z){var y=z?w.boxShadow:w.innerShadow;if(y&&y!=="none"){var x=y.split("px ");y={x:parseInt(x[0],10),y:parseInt(x[1],10),blur:parseInt(x[2],10),color:x[3]}}else{y={x:0,y:0,blur:0,color:""}}if(z){if(y.x<0){w.shadowLeft=Math.abs(y.x)+y.blur;w.shadowRight=y.blur+y.x}else{w.shadowLeft=Math.abs(y.blur-y.x);w.shadowRight=y.blur+y.x}if(y.y<0){w.shadowTop=Math.abs(y.y)+y.blur;w.shadowBottom=y.blur+y.y}else{w.shadowTop=Math.abs(y.blur-y.y);w.shadowBottom=y.blur+y.y}w.shadowWidth=w.shadowLeft+w.shadowRight;w.shadowHeight=w.shadowTop+w.shadowBottom}return y}var j=document.createElement("canvas");var l=j.getContext("2d");var g=document.createElement("canvas");var a=g.getContext("2d");PIXI.ButtonFactory=function(z,I,C){if(!m(C.boxShadow)){C.boxShadow=b(C,true);C.outerWidth=C.width+C.padding*2+C.borderWidth*2+C.shadowWidth;C.outerHeight=C.height+C.padding*2+C.borderWidth*2+C.shadowHeight}if(!m(C.innerShadow)){C.innerShadow=b(C,false)}var G=C.outerWidth||C.width||100;var E=C.outerHeight||C.height||30;var F=C.borderRadius;var O=C.borderWidth;var B=C.shadowWidth;var M=C.shadowHeight;var D=C.shadowLeft;var L=C.shadowTop;z.width=G;z.height=E;if(o){I.clearRect(0,0,G,E)}I.shadowOffsetX=C.boxShadow.x;I.shadowOffsetY=C.boxShadow.y;I.shadowBlur=C.boxShadow.blur;I.shadowColor=C.boxShadow.color;if(C.borderWidth>0){I.fillStyle=C.borderColor;k(I,D,L,G-B,E-M,F);I.fill();I.shadowOffsetX=0;I.shadowOffsetY=0;I.shadowBlur=0}var K=C.textboxHeight=E-O*2-M;var H=C.textboxTop=O+L;var J=C.textboxWidth=G-O*2-B;var A=C.textboxLeft=O+D;if(!C.bgImage&&C.backgroundImage){C.bgImage=PIXI.Texture.fromImage(C.backgroundImage);if(C.bgImage.baseTexture.hasLoaded){C.dirty=true}else{C.bgImage.on("update",function(){C.dirty=true})}}if(!C.bgImage||!C.backgroundImage||!C.bgImage.baseTexture.hasLoaded){if(C.backgroundGradient&&!m(C.backgroundColor)){var w=C.backgroundGradient.length;if(w<2){return}C.backgroundColor=I.createLinearGradient(0,0,0,E);for(var N=0;N<w;N++){var x=C.backgroundGradient[N];if(x.length===2){C.backgroundColor.addColorStop(x[0],x[1])}else{C.backgroundColor.addColorStop(N/(w-1),x)}}}I.fillStyle=C.backgroundColor;k(I,A,H,J,K,F);I.fill()}else{I.drawImage(C.bgImage,0,0,C.bgImage.width,C.bgImage.height,A,H,J,K)}I.shadowOffsetX=0;I.shadowOffsetY=0;I.shadowBlur=0;var y=C.innerShadow;if(y.blur>0){j.width=C.width+C.padding*2;j.height=C.height+C.padding*2;l.shadowBlur=y.blur;l.shadowColor=y.color;l.shadowOffsetX=0;l.shadowOffsetY=y.y;l.fillRect(-1*G,-100,3*G,100);l.shadowOffsetX=y.x;l.shadowOffsetY=0;l.fillRect(j.width,-1*E,100,3*E);l.shadowOffsetX=0;l.shadowOffsetY=y.y;l.fillRect(-1*G,j.height,3*G,100);l.shadowOffsetX=y.x;l.shadowOffsetY=0;l.fillRect(-100,-1*E,100,3*E);k(I,O+D,O+L,G-O*2-B,E-O*2-M,F);I.clip();I.drawImage(j,0,0,j.width,j.height,O+D,O+L,j.width,j.height)}};PIXI.InputObject=function(x){this.tabIndex=x!==h?x:PIXI.InputObject.tabIndex++;PIXI.Sprite.call(this,PIXI.Texture.fromCanvas(this.canvas));PIXI.InputObject.inputs.push(this);this.resolution=1;if(!o){if(!PIXI.InputObject.hiddenInput){var w=document.createElement("input");w.type="text";w.tabindex=-1;w.style.position="fixed";w.style.opacity=0;w.style.pointerEvents="none";w.style.left="0px";w.style.bottom="0px";w.style.left="-100px";w.style.top="-100px";w.style.zIndex=10;w.addEventListener("blur",function(){if(PIXI.InputObject.currentInput){PIXI.InputObject.currentInput.onMouseUpOutside()}},false);w.addEventListener("keydown",function(y){if(PIXI.InputObject.currentInput){y=y||window.event;if(PIXI.InputObject.currentInput.data.hasFocus){PIXI.InputObject.currentInput.onKeyDown(y)}}});w.addEventListener("keyup",function(y){if(PIXI.InputObject.currentInput){y=y||window.event;if(PIXI.InputObject.currentInput.data.hasFocus){PIXI.InputObject.currentInput.onKeyUp(y)}}});document.body.appendChild(w);PIXI.InputObject.textProp=d(w);PIXI.InputObject.hiddenInput=w}this.hiddenInput=PIXI.InputObject.hiddenInput}this._textNeedsUpdate=true;this.data.dirty=true;this.update()};PIXI.InputObject.prototype=Object.create(PIXI.Sprite.prototype);PIXI.InputObject.prototype.constructor=PIXI.InputObject;i(PIXI.InputObject.prototype,{updateData:function(w){if(w.hasOwnProperty("text")){this._textStyleNeedsUpdate=true}this.data=i(w,this.data);this.data.dirty=true;if(w.hasOwnProperty("value")||this._textStyleNeedsUpdate){this._textNeedsUpdate=true}},focus:function(){if(PIXI.InputObject.currentInput===this){return}if(PIXI.InputObject.currentInput){PIXI.InputObject.currentInput.blur()}PIXI.InputObject.currentInput=this;this.data.hasFocus=true;this.data.onfocus();if(this.data.readonly){return}this.hiddenInput.focus()},blur:function(){if(PIXI.InputObject.currentInput===this){PIXI.InputObject.currentInput=null;this.data.hasFocus=false;this.hiddenInput.blur();this.data.onblur()}},onKeyUp:function(){},onKeyDown:function(){},onClick:function(){},onMouseMove:function(){},onMouseDown:function(){},onMouseUp:function(){},onMouseUpOutside:function(w){if(this.data.hasFocus&&!this.data.mouseDown){this.blur()}this.data.mouseDown=false},updateTexture:function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;if(n){this.requiresUpdate=true}else{this.texture.update()}},_renderWebGL:function(w){if(n){if(this.requiresUpdate){this.requiresUpdate=false;PIXI.updateWebGLTexture(this.texture.baseTexture,w.gl)}}else{this.resolution=w.resolution;this.texture.baseTexture.resolution=this.resolution}PIXI.Sprite.prototype._renderWebGL.call(this,w)},destroy:function(){this.interactive=false;this.context=null;this.canvas=null;this.texture.destroy(true);PIXI.InputObject.inputs.splice(PIXI.InputObject.inputs.indexOf(this),1)}},true);Object.defineProperty(PIXI.InputObject.prototype,"width",{get:function(){this.update();return this.scale.x*this.texture.frame.width},set:function(w){this.scale.x=w/this.texture.frame.width;this._width=w}});Object.defineProperty(PIXI.InputObject.prototype,"height",{get:function(){this.update();return this.scale.y*this.texture.frame.height},set:function(w){this.scale.y=w/this.texture.frame.height;this._height=w}});PIXI.InputObject.tabIndex=0;PIXI.InputObject.currentCanvas=null;PIXI.InputObject.currentInput=null;PIXI.InputObject.hiddenInput=null;PIXI.InputObject.inputs=[];PIXI.InputObject.Styles={};PIXI.InputObject.TextCache={};PIXI.InputObject.textProp="value";PIXI.InputObject.Tab=function(z,y,x){z.preventDefault();if(PIXI.InputObject.inputs.length>1){var w=PIXI.InputObject.inputs.indexOf(x);while(true){if(++w>=PIXI.InputObject.inputs.length){w=0}if(PIXI.InputObject.inputs[w]===x){break}else{if(PIXI.InputObject.inputs[w].tabIndex!==-1){x.blur();setTimeout(function(){PIXI.InputObject.inputs[w].focus()},10);break}}}}};PIXI.InputObject.Style=function(x,y,w){if(y===h){return PIXI.InputObject.Styles[x]||{}}PIXI.InputObject.Styles[x]=y;if(w){delete PIXI.InputObject.Styles[x]}};PIXI.InputObject.blur=function(){if(PIXI.InputObject.currentInput&&!PIXI.InputObject.currentInput.data.mouseDown){PIXI.InputObject.currentInput.blur();PIXI.InputObject.currentInput=null}};window.addEventListener("blur",PIXI.InputObject.blur,false);PIXI.InputObject.setCanvas=function(w){if(!s){if(PIXI.InputObject.currentCanvas!==w){if(PIXI.InputObject.currentCanvas){PIXI.InputObject.currentCanvas.removeEventListener("mousedown",PIXI.InputObject.blur,true);PIXI.InputObject.currentCanvas.removeEventListener("touchstart",PIXI.InputObject.blur,true)}if(w){w.addEventListener("mousedown",PIXI.InputObject.blur,true);w.addEventListener("touchstart",PIXI.InputObject.blur,true)}PIXI.InputObject.currentCanvas=w}}};PIXI.InputObject.getTextCache=function(x,w){var y=x.textCache?x.textCache.__id:null;var z=x.data.text.font+"_"+x.data.text.strokeThickness;if(y){--PIXI.InputObject.TextCache[y].count;if(w){if(PIXI.InputObject.TextCache[y].count<=0){PIXI.InputObject.TextCache[y]=null}return}}if(!PIXI.InputObject.TextCache[z]){PIXI.InputObject.TextCache[z]={count:0,__id:z}}PIXI.InputObject.TextCache[z].count++;return PIXI.InputObject.TextCache[z]};PIXI.Input=function(w){this.data=w||{};if(this.data.style){this.data=i(this.data,PIXI.InputObject.Style(this.data.style))}this.data=i(this.data,r);this.data=i(this.data,t);this.data.selection=[0,0];this.data.clipPos=[0,0];this.data.cursorPos=0;this.cursorTimer=0;this.data.value=(this.data.value||this.data.placeholder||"")+"";this.currText=this.data.value;if(!this.data.text.bitmap){this.text=new PIXI.Text(this.data.value,this.data.text);this.textCache=PIXI.InputObject.getTextCache(this)}else{this.text=new PIXI.BitmapText(this.data.value||"Temp",this.data.text);this.text._isBitmapFont=true;this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale;if(!this.data.value){this._textNeedsUpdate=true}}this.cursor=new PIXI.Text("|",this.data.text);this.cursor.visible=false;this.selection=new PIXI.Sprite(p(this.data.selectionColor));this.data.height=this.data.height||v(this.text);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=this.data.width;this.canvas.height=this.data.height;PIXI.InputObject.call(this);this.addChild(this.selection);this.addChild(this.text);this.addChild(this.cursor);this.boundOnMouseUp=this.onMouseUp.bind(this);this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this);this.boundOnMouseDown=this.onMouseDown.bind(this);this.boundOnMouseMove=this.onMouseMove.bind(this);this.interactive=true;this.defaultCursor="text";this.buttonMode=true;this.mousemove=this.touchmove=this.boundOnMouseMove;this.mousedown=this.touchstart=this.boundOnMouseDown;this.mouseup=this.touchend=this.boundOnMouseUp;this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside};PIXI.Input.prototype=Object.create(PIXI.InputObject.prototype);PIXI.Input.prototype.constructor=PIXI.Input;i(PIXI.Input.prototype,{focus:function(){PIXI.InputObject.prototype.focus.call(this);if(this.data.readonly){return}if(o){this.value=prompt(this.data.placeholder||"Enter Text",this.value)||this.value;this._textNeedsUpdate=true;return}this.hiddenInput.type=this.data.type||"text";if(this.data.maxlength){this.hiddenInput.maxLength=this.data.maxlength}else{this.hiddenInput.removeAttribute("maxLength")}if(this.data.type==="number"){if(this.data.min!==h){this.hiddenInput.min=this.data.min}if(this.data.max!==h){this.hiddenInput.max=this.data.max}}else{this.hiddenInput.removeAttribute("min");this.hiddenInput.removeAttribute("max")}this.currText=this.value;this.data.value=this.currText;u(this.hiddenInput,PIXI.InputObject.textProp,this.currText);this._textNeedsUpdate=true},blur:function(w){w=w||this;PIXI.InputObject.prototype.blur.call(w);if(w.data.value===""){w.data.value=w.data.placeholder}w.clearSelection();this.cursor.visible=false;w._textNeedsUpdate=true},onKeyDown:function(y){this.data.selectionStart=-1;var w=y.which,x=y.shiftKey,z=null,A,B;if(y.which===27){this.blur();return}this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this.data.onkeydown(y,this);if(w===65&&(y.ctrlKey||y.metaKey)){y.preventDefault();this.data.selection[0]=0;this.data.selection[1]=this.value.length;this.hiddenInput.selectionStart=0;this.hiddenInput.selectionEnd=this.value.length;return}if(w===17||y.metaKey||y.ctrlKey){return}if(w===13){y.preventDefault();this.data.onsubmit(y,this)}else{if(w===9){PIXI.InputObject.Tab(y,w,this);return}}this.updateTextState()},onKeyUp:function(w){this.data.onkeyup(w,this);this.updateTextState()},updateTextState:function(){var w=c(this.hiddenInput,PIXI.InputObject.textProp);if(w!==this.data.value){this.data.value=w;this._textNeedsUpdate=true}if(this.data.selection[0]!==this.hiddenInput.selectionStart||this.data.selection[1]!==this.hiddenInput.selectionEnd){this.data.selection[0]=this.hiddenInput.selectionStart;this.data.selection[1]=this.hiddenInput.selectionEnd;this.data.cursorPos=this.data.selection[0];this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this._cursorNeedsUpdate=true}},onMouseMove:function(z){if(!this.data.hasFocus||!this.data.mouseDown||this.data.selectionStart<0||!this.stage.data.interactionManager.hitTest(this,z)){return}var w=this.mousePos(z);var y=this.clickPos(w.x,w.y),x=Math.min(this.data.selectionStart,y),A=Math.max(this.data.selectionStart,y);if(this.data.selection[0]!==x||this.data.selection[1]!==A){this.data.selection[0]=x;this.data.selection[1]=A;if(!o){this.hiddenInput.selectionStart=x;this.hiddenInput.selectionEnd=A}this.data.cursorPos=y;this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this._cursorNeedsUpdate=true}},onMouseDown:function(x){if(x.data.originalEvent.which===2||x.data.originalEvent.which===3){x.originalEvent.preventDefault();return}this.focus();var w=this.mousePos(x);this.data.mouseDown=true;if(this.data.value===this.data.placeholder){this._textNeedsUpdate=true}this.data.selectionStart=this.clickPos(w.x,w.y);this.data.selection[0]=this.data.selectionStart;this.data.selection[1]=this.data.selectionStart;if(!o){this.hiddenInput.selectionStart=this.data.selectionStart;this.hiddenInput.selectionEnd=this.data.selectionStart}this.data.cursorPos=this.data.selectionStart;this._cursorNeedsUpdate=true;this._selectionNeedsUpdate=true},onMouseUp:function(y){if(y.data.originalEvent.which===2||y.data.originalEvent.which===3){y.originalEvent.preventDefault();return}var w=this.mousePos(y);var x=this.clickPos(w.x,w.y);if(!(this.data.selectionStart>=0&&x!==this.data.selectionStart)){this.data.cursorPos=x;this.data.selection[0]=this.data.cursorPos;this.data.selection[1]=this.data.cursorPos;if(!o){this.hiddenInput.selectionStart=this.data.cursorPos;this.hiddenInput.selectionEnd=this.data.cursorPos}this._cursorNeedsUpdate=true}this.data.selectionStart=-1;this.data.mouseDown=false},update:function(w){if(w||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate||this._selectionNeedsUpdate){if(this.data.dirty){this.renderTexture();this.data.dirty=false}if(this._textStyleNeedsUpdate){this.text.setStyle(this.data.text);this.cursor.setStyle(this.data.text);this.cursor.updateText();if(!this.text._isBitmapFont){this.textCache=PIXI.InputObject.getTextCache(this)}else{this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this._textStyleNeedsUpdate=false}if(this._textNeedsUpdate){this.currText=this.clipText();this.text.setText(this.currText||"");this.text.updateText();this._textNeedsUpdate=false}if(this._selectionNeedsUpdate){this.updateSelection();this._selectionNeedsUpdate=false}}},updateSelection:function(){if(this.data.selection[0]!==this.data.selection[1]){this.selection.visible=true;this.selection.x=(this.selection.y+this.textWidth(this.currText.substring(0,this.data.selection[0]-this.data.clipPos[0])))|0;this.selection.width=Math.ceil(this.textWidth(this.currText.substring(this.data.selection[0]-this.data.clipPos[0],this.data.selection[1]-this.data.clipPos[0])))+this.text.style.strokeThickness}else{this.selection.visible=false}},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data);if(this.data.valign==="none"||!this.data.valign){this.text.y=this.data.padding|0}else{if(this.data.valign==="middle"){this.text.y=(this.data.textboxTop+((this.data.textboxHeight-this.text.height)/2))|0}else{if(this.data.valign==="top"){this.text.y=this.data.textboxTop|0}else{if(this.data.valign==="bottom"){this.text.y=(this.data.textboxTop+this.data.textboxHeight-this.text.height)|0}}}}this.cursor.y=this.text.y;this.data.placeholderAlign=this.data.placeholderAlign||this.data.align;this.text.x=(this.data.textboxLeft+this.data.padding)|0;var w=(this.data.padding+this.data.borderWidth+this.data.shadowTop)|0;this.selection.y=w;this.selection.height=this.data.height;this._cursorNeedsUpdate=true;this._selectionNeedsUpdate=true;this.updateTexture()},clipText:function(E){var B=E===h,y=0;E=B?(this.data.mouseDown||this.data.hasFocus?this.value:(this.data.value||this.data.placeholder||"")):E;if(this.data.type==="password"&&E!==this.data.placeholder){E=E.replace(/./g,"*")}var C=this.textWidth(E),w=E.length,z=(this.data.width-2*this.data.padding),D=E;if(B&&E!==this.data.placeholder){this.data.cursorPos=this.data.cursorPos||0;if(w<this.data.clipPos[0]){this.data.clipPos[0]=0}if(this.data.cursorPos>this.data.clipPos[1]){y=this.data.clipPos[0];E=E.substr(y,this.data.cursorPos-this.data.clipPos[0])||""}else{if(this.data.cursorPos<this.data.clipPos[0]){y=this.data.cursorPos;E=E.substr(y)||""}else{y=this.data.clipPos[0];E=E.substr(y)}}if(E!==D){C=this.textWidth(E),w=E.length}}if(C>z){if(!this.text._isBitmapFont){var x=this.textCache,A="";while(C>z){if(B&&this.data.cursorPos>this.data.clipPos[1]){A=E[0];x[A]=x[A]||this.textWidth(A);C-=x[A];E=E.substr(1,--w);y++}else{A=E[--w];x[A]=x[A]||this.textWidth(A);C-=x[A];E=E.substr(0,w)}}}else{while(C>z){if(B&&this.data.cursorPos>this.data.clipPos[1]){C-=this.textWidth(E[0]);E=E.substr(1,--w);y++}else{C-=this.textWidth(E[--w]);E=E.substr(0,w)}}}}if(B&&E!==this.data.placeholder){this.data.clipPos[0]=y;this.data.clipPos[1]=y+w}return E+""},clickPos:function(z,B){var y=this.currText,w=0,A=y.length;if(z<this.textWidth(y)){for(var x=0;x<y.length;x++){w+=this.textWidth(y[x]);if(w>=z){A=x;break}}}return this.data.clipPos[0]+A},textWidth:function(C){if(!this.text._isBitmapFont){var w=this.context;w.font=this.text.style.font;w.textAlign="left";return w.measureText(C||"").width}else{var A=null;var x=0;var y=this.text._data;for(var B=0;B<C.length;B++){var D=C.charCodeAt(B);var z=y.chars[D];if(!z){continue}if(A&&z.kerning[A]){x+=z.kerning[A]}x+=z.xAdvance;A=D}return x*this.text._scale}},mousePos:function(w){return w.data.getLocalPosition(w.target||this)},clearSelection:function(){if(this.data.selection[1]!==this.data.selection[0]){this.data.cursorPos=0;this.data.selection[0]=0;this.data.selection[1]=0;if(!o){this.hiddenInput.selectionStart=0;this.hiddenInput.selectionEnd=0}this._cursorNeedsUpdate=true;this._selectionNeedsUpdate=true}},updateTransform:function(){this.update();if(this.data.hasFocus||this.data.mouseDown){var w=Date.now();if((w-this.cursorTimer)>=q){this.cursorTimer=w;this.cursor.visible=!this.cursor.visible}if(this.selection.visible){this.cursor.visible=false}if(this.cursor.visible&&this._cursorNeedsUpdate){this.cursor.x=(this.selection.y-1+this.textWidth(this.currText.substring(0,this.data.cursorPos-this.data.clipPos[0])))|0;this._cursorNeedsUpdate=false}}else{this.selection.visible=false;this.cursor.visible=false}PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){if(!this.text._isBitmapFont){PIXI.InputObject.getTextCache(this,true);this.text.destroy(true)}else{this.text=null}this.cursor.destroy(true);PIXI.InputObject.prototype.destroy.call(this)}},true);Object.defineProperty(PIXI.Input.prototype,"value",{get:function(){return this.data.value===this.data.placeholder?"":this.data.value},set:function(w){this.data.value=w+"";u(this.hiddenInput,PIXI.InputObject.textProp,w+"");this._textNeedsUpdate=true}});PIXI.Button=function(w){this.tabIndex=-1;this.data=w||{};if(this.data.style){this.data=i(this.data,PIXI.InputObject.Style(this.data.style))}this.data=i(this.data,r);this.data=i(this.data,t);if(!this.data.text.bitmap){this.text=new PIXI.Text(this.data.value,this.data.text)}else{this.text=new PIXI.BitmapText(this.data.value||"Temp",this.data.text);this.text._isBitmapFont=true;this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale;if(!this.data.value){this._textNeedsUpdate=true}}this.data.height=this.data.height||v(this.text);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=this.data.width;this.canvas.height=this.data.height;PIXI.InputObject.call(this,-1);this.addChild(this.text);this.boundOnMouseUp=this.onMouseUp.bind(this);this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this);this.boundOnMouseDown=this.onMouseDown.bind(this);this.interactive=true;this.buttonMode=true;this.mousedown=this.touchstart=this.boundOnMouseDown;this.mouseup=this.touchend=this.boundOnMouseUp;this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside};PIXI.Button.prototype=Object.create(PIXI.InputObject.prototype);PIXI.Button.prototype.constructor=PIXI.Button;i(PIXI.Button.prototype,{focus:function(){PIXI.InputObject.prototype.focus.call(this)},blur:function(w){PIXI.InputObject.prototype.blur.call(w||this)},onMouseDown:function(w){this.focus();this.data.mouseDown=true;this.data.onmousedown(w,this)},onMouseUp:function(w){this.data.onmouseup(w,this);this.data.mouseDown=false},update:function(w){if(w||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate){if(this.data.dirty){this.renderTexture();this.data.dirty=false}if(this._textStyleNeedsUpdate){this.text.setStyle(this.data.text);if(this.text._isBitmapFont){this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this._textStyleNeedsUpdate=false}if(this._textNeedsUpdate){this.text.setText(this.data.value||"");this.text.updateText();if(this.data.align==="center"){this.text.x=((this.data.outerWidth-this.text.width)/2)|0}else{if(this.data.align==="right"){this.text.x=(this.data.outerWidth-this.text.width-this.data.textboxLeft-this.data.padding)|0}}this._textNeedsUpdate=false}}},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data);if(this.data.valign==="none"||!this.data.valign){this.text.y=this.data.padding|0}else{if(this.data.valign==="middle"){this.text.y=(this.data.textboxTop+((this.data.textboxHeight-this.text.height)/2))|0}else{if(this.data.valign==="top"){this.text.y=this.data.textboxTop|0}else{if(this.data.valign==="bottom"){this.text.y=(this.data.textboxTop+this.data.textboxHeight-this.text.height)|0}}}}this.text.x=(this.data.textboxLeft+this.data.padding)|0;this.updateTexture()},updateTransform:function(){this.update();PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){if(this.text._isBitmapFont){this.text.destroy(true)}else{this.text=null}PIXI.InputObject.prototype.destroy.call(this)}},true);Object.defineProperty(PIXI.Button.prototype,"value",{get:function(){return this.data.value},set:function(w){this.data.value=w+"";this._textNeedsUpdate=true}});PIXI.Select=function(x){this.data=x||{};if(this.data.style){this.data=i(this.data,PIXI.InputObject.Style(this.data.style))}this.data=i(this.data,r);this.data=i(this.data,t);this.data.options=this.data.options||{};this.data.selected=this.data.selected||null;this.selectedIndex=0;this.lineHeight=20;this.options=[];if(!this.data.text.bitmap){this.text=new PIXI.Text("",this.data.text)}else{this.text=new PIXI.BitmapText("Temp",this.data.text);this.text._isBitmapFont=true;this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this.selection=new PIXI.Sprite(p(this.data.selectionColor));this.selection.visible=false;this.menu=new PIXI.Sprite(p(this.data.backgroundColor));this.menu.visible=false;this.data.height=this.data.height||v(this.text);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=this.data.width;this.canvas.height=this.data.height;PIXI.InputObject.call(this);this.addChild(this.text);this.addChild(this.menu);this.addChild(this.selection);this.boundOnMouseUp=this.onMouseUp.bind(this);this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this);this.boundOnMouseDown=this.onMouseDown.bind(this);this.interactive=true;this.mousedown=this.touchstart=this.boundOnMouseDown;this.mouseup=this.touchend=this.boundOnMouseUp;this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside;var y="";for(var w in this.data.options){if(this.data.selected===w){this.selectedIndex=this.options.length}this.options.push({value:w,text:this.data.options[w]});y+=this.data.options[w]+"\n"}if(!this.data.optionText||!this.data.optionText.bitmap){this.optionstext=new PIXI.Text(y,this.data.optionText||{font:"14px arial"});this.lineHeight=(this.optionstext.height/(this.options.length+1)-this.optionstext.style.strokeThickness/2)|0}else{this.optionstext=new PIXI.BitmapText(y,this.data.optionText);this.optionstext._isBitmapFont=true;this.optionstext._data=PIXI.BitmapText.fonts[this.optionstext.fontName];this.optionstext._scale=this.optionstext.fontSize/this.optionstext._data.size;this.optionstext._lineHeight=this.optionstext._data.lineHeight*this.optionstext._scale;this.lineHeight=this.optionstext._lineHeight}this.optionstext.visible=false;this.addChild(this.optionstext);this.menu.height=this.lineHeight*this.options.length-1;this.menu.interactive=true;this.menu.mousedown=this.menu.touchstart=function(z){if(z.data.originalEvent.which===2||z.data.originalEvent.which===3){z.originalEvent.preventDefault();this.displayMenu(false);return}this.selectedIndex=this.getIndexByLocalPosition(z);this.updateText()}.bind(this);this.menu.mousemove=this.menu.touchmove=function(z){if(this.menu.stage&&this.menu.stage.interactionManager.hitTest(this.menu,z)){this.menu.selectedIndex=this.getIndexByLocalPosition(z);this.updateSelection(this.menu.selectedIndex)}}.bind(this);this.updateText()};PIXI.Select.prototype=Object.create(PIXI.InputObject.prototype);PIXI.Select.prototype.constructor=PIXI.Select;i(PIXI.Select.prototype,{getIndexByLocalPosition:function(x){var y=x.data.getLocalPosition(this).y-this.menu.startY;if(y<1||y>this.menu.height){return}var w=Math.floor(y/(this.lineHeight+1));if(w<0){w=0}else{if(w>=this.options.length){w=this.options.length-1}}return w},updateText:function(){var w=this.value;if(w){if(this.data.value!==w.text){this.data.value=w.text}this._textNeedsUpdate=true;this.updateSelection()}else{this.data.value=""}},updateSelection:function(w){this.selection.y=this.menu.startY+this.lineHeight*(w!==h?w:this.selectedIndex)},focus:function(){PIXI.InputObject.prototype.focus.call(this)},blur:function(w){w=w||this;PIXI.InputObject.prototype.blur.call(w);w.displayMenu(false)},onKeyDown:function(y){var w=y.which,x=y.shiftKey,z=null,A,B;if(y.which===27){this.blur();return}this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this.data.onkeydown(y,this);if(w===32||w===13){y.preventDefault();if(this.menu.visible){this.displayMenu(false);if(this.menu.selectedIndex){this.selectedIndex=this.menu.selectedIndex;this.menu.selectedIndex=null;this.updateText()}}else{this.displayMenu(true)}return}if(w===9){PIXI.InputObject.Tab(y,w,this);return}if(w===38){this.selectedIndex--;if(this.selectedIndex<0){this.selectedIndex=0}this.updateText()}if(w===40){this.selectedIndex++;if(this.selectedIndex>=this.options.length){this.selectedIndex=this.options.length-1}this.updateText()}},onKeyUp:function(w){this.data.onkeyup(w,this);if(!this.menu.selectedIndex){this.updateText()}},onMouseDown:function(w){this.focus();this.data.mouseDown=true;this.data.onmousedown(w,this)},onMouseUp:function(w){this.data.onmouseup(w,this);this.data.mouseDown=false;this.focus();this.displayMenu(!this.menu.visible)},displayMenu:function(x){this.menu.visible=x;this.selection.visible=false;this.optionstext.visible=false;if(!x){return}this.menu.x=this.data.textboxLeft;this.menu.width=this.data.textboxWidth;this.selection.x=this.data.textboxLeft;this.selection.width=this.data.textboxWidth;this.selection.height=this.lineHeight;var w=this.stage?this.stage.interactionManager.target.height:0;var z=this.y-this.height*this.anchor.y;var y=w-(z+this.height);if(this.menu.height>y){if(z>y){this.menu.anchor.y=1;this.menu.y=1}else{this.menu.anchor.y=0;this.menu.y=this.height-1}}else{this.menu.anchor.y=0;this.menu.y=this.height-1}this.menu.startY=this.menu.y-this.menu.height*this.menu.anchor.y;this.menu.selectedIndex=null;this.optionstext.y=this.menu.startY;this.optionstext.x=5;this.optionstext.visible=true;if(this.value){this.selection.visible=true;this.updateSelection()}},update:function(w){if(w||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate){if(this.data.dirty){this.renderTexture();this.data.dirty=false}if(this._textStyleNeedsUpdate){this.text.setStyle(this.data.text);if(this.text._isBitmapFont){this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this._textStyleNeedsUpdate=false}if(this._textNeedsUpdate){this.text.setText(this.data.value||"");this.text.updateText();this._textNeedsUpdate=false}}},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data);PIXI.ButtonFactory(g,a,{backgroundGradient:["#bbb","#eee","#bbb"],borderWidth:1,borderColor:this.data.borderColor,borderRadius:[0,this.data.borderRadius,this.data.borderRadius,0],boxShadow:"none",innerShadow:"none",padding:0,width:25,height:this.data.outerHeight});a.beginPath();a.moveTo(9+this.data.borderWidth-2,this.data.outerHeight/3+this.data.borderWidth+1);a.lineTo(17-this.data.borderWidth,this.data.outerHeight/3+this.data.borderWidth+1);a.lineTo(12,2*this.data.outerHeight/3-this.data.borderWidth+2);a.closePath();a.fillStyle="#000";a.fill();this.context.drawImage(g,0,0,25,this.data.outerHeight,this.data.outerWidth-25,0,25,this.data.outerHeight);if(this.data.valign==="none"||!this.data.valign){this.text.y=this.data.padding|0}else{if(this.data.valign==="middle"){this.text.y=(this.data.textboxTop+((this.data.textboxHeight-this.text.height)/2))|0}else{if(this.data.valign==="top"){this.text.y=this.data.textboxTop|0}else{if(this.data.valign==="bottom"){this.text.y=(this.data.textboxTop+this.data.textboxHeight-this.text.height)|0}}}}this.text.x=(this.data.textboxLeft+this.data.padding)|0;this.updateTexture()},updateTransform:function(){this.update();PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){if(!this.text._isBitmapFont){this.text.destroy(true)}else{this.text=null}if(!this.optionstext._isBitmapFont){this.optionstext._isBitmapFont.destroy(true)}else{this.optionstext=null}PIXI.InputObject.prototype.destroy.call(this)}},true);Object.defineProperty(PIXI.Select.prototype,"value",{get:function(){if(this.options[this.selectedIndex]){return this.options[this.selectedIndex]}return null},set:function(w){}})})();