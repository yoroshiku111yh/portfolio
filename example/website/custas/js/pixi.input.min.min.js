(function(K){var H=PIXI.VERSION.indexOf("v1")!==-1;var w=navigator&&navigator.isCocoonJS;var D=(typeof window.orientation!=="undefined");var F=300;function M(){}var E={readonly:false,maxlength:null,placeholder:"",placeholderColor:"#bfbebd",placeholderAlign:"",selectionColor:"rgba(179, 212, 253, 0.8)",selectionUpdated:false,selectionStart:-1,value:"",type:"text",onsubmit:M,onkeydown:M,onkeyup:M,onfocus:M,onblur:M,onmousedown:M,onmouseup:M,cursorPos:0,hasFocus:false,mouseDown:false};var C={width:170,height:null,padding:5,borderColor:"#000",borderWidth:1,borderRadius:3,backgroundImage:null,backgroundColor:"#fff",backgroundGradient:null,boxShadow:"1px 1px 0px rgba(0, 0, 0, 0.1)",innerShadow:"0px 0px 4px rgba(0, 0, 0, 0.4)",valign:"middle",align:"center",outline:0,text:{font:"14px Arial",fill:"#000",align:"left",stroke:"#000",strokeThickness:0}};function O(a){if(a.value!==K){return"value"}if(a.text!==K){return"text"}if(a.textContent!==K){return"textContent"}return"innerText"}function B(b,c,a){b[c]=a}function P(b,a){return b[a].replace(/\r/g,"")}function I(a){return typeof a==="object"&&!!a&&!(a instanceof Array)}var N={};function G(a){var c=N[a];if(!c){var d=document.createElement("canvas");d.width=2;d.height=2;var b=d.getContext("2d");b.fillStyle=a;b.fillRect(0,0,2,2);c=PIXI.Texture.fromCanvas(d);N[a]=c}return c}function z(b,d,e){for(var a in d){if(e){b[a]=d[a];continue}var c=I(d[a]);if(!b.hasOwnProperty(a)){b[a]=c?{}:d[a]}if(c){if(!I(b[a])){b[a]={}}z(b[a],d[a])}}return b}function A(a){if(a._isBitmapFont){return a._lineHeight}if(H||a.determineFontHeight){return a.determineFontHeight("font: "+a.style.font+";")+a.style.strokeThickness}else{return parseInt(a.determineFontProperties(a.style.font).fontSize,10)+a.style.strokeThickness}}function y(f,h,i,g,j,e){if(e instanceof Array){var a=e[0],b=e[1],c=e[2],d=e[3]}else{var a=e,b=e,c=e,d=e}if(g<2*a||j<2*a){return y(f,h,i,g||1,j||1,0)}f.beginPath();f.moveTo(h+a,i);f.lineTo(h+g-b,i);f.quadraticCurveTo(h+g,i,h+g,i+b);f.lineTo(h+g,i+j-c);f.quadraticCurveTo(h+g,i+j,h+g-c,i+j);f.lineTo(h+d,i+j);f.quadraticCurveTo(h,i+j,h,i+j-d);f.lineTo(h,i+a);f.quadraticCurveTo(h,i,h+a,i);f.closePath()}function Q(b,c){var d=c?b.boxShadow:b.innerShadow;if(d&&d!=="none"){var a=d.split("px ");d={x:parseInt(a[0],10),y:parseInt(a[1],10),blur:parseInt(a[2],10),color:a[3]}}else{d={x:0,y:0,blur:0,color:""}}if(c){if(d.x<0){b.shadowLeft=Math.abs(d.x)+d.blur;b.shadowRight=d.blur+d.x}else{b.shadowLeft=Math.abs(d.blur-d.x);b.shadowRight=d.blur+d.x}if(d.y<0){b.shadowTop=Math.abs(d.y)+d.blur;b.shadowBottom=d.blur+d.y}else{b.shadowTop=Math.abs(d.blur-d.y);b.shadowBottom=d.blur+d.y}b.shadowWidth=b.shadowLeft+b.shadowRight;b.shadowHeight=b.shadowTop+b.shadowBottom}return d}var J=document.createElement("canvas");var x=J.getContext("2d");var L=document.createElement("canvas");var R=L.getContext("2d");PIXI.ButtonFactory=function(p,g,m){if(!I(m.boxShadow)){m.boxShadow=Q(m,true);m.outerWidth=m.width+m.padding*2+m.borderWidth*2+m.shadowWidth;m.outerHeight=m.height+m.padding*2+m.borderWidth*2+m.shadowHeight}if(!I(m.innerShadow)){m.innerShadow=Q(m,false)}var i=m.outerWidth||m.width||100;var k=m.outerHeight||m.height||30;var j=m.borderRadius;var a=m.borderWidth;var n=m.shadowWidth;var c=m.shadowHeight;var l=m.shadowLeft;var d=m.shadowTop;p.width=i;p.height=k;if(w){g.clearRect(0,0,i,k)}g.shadowOffsetX=m.boxShadow.x;g.shadowOffsetY=m.boxShadow.y;g.shadowBlur=m.boxShadow.blur;g.shadowColor=m.boxShadow.color;if(m.borderWidth>0){g.fillStyle=m.borderColor;y(g,l,d,i-n,k-c,j);g.fill();g.shadowOffsetX=0;g.shadowOffsetY=0;g.shadowBlur=0}var e=m.textboxHeight=k-a*2-c;var h=m.textboxTop=a+d;var f=m.textboxWidth=i-a*2-n;var o=m.textboxLeft=a+l;if(!m.bgImage&&m.backgroundImage){m.bgImage=PIXI.Texture.fromImage(m.backgroundImage);if(m.bgImage.baseTexture.hasLoaded){m.dirty=true}else{m.bgImage.on("update",function(){m.dirty=true})}}if(!m.bgImage||!m.backgroundImage||!m.bgImage.baseTexture.hasLoaded){if(m.backgroundGradient&&!I(m.backgroundColor)){var s=m.backgroundGradient.length;if(s<2){return}m.backgroundColor=g.createLinearGradient(0,0,0,k);for(var b=0;b<s;b++){var r=m.backgroundGradient[b];if(r.length===2){m.backgroundColor.addColorStop(r[0],r[1])}else{m.backgroundColor.addColorStop(b/(s-1),r)}}}g.fillStyle=m.backgroundColor;y(g,o,h,f,e,j);g.fill()}else{g.drawImage(m.bgImage,0,0,m.bgImage.width,m.bgImage.height,o,h,f,e)}g.shadowOffsetX=0;g.shadowOffsetY=0;g.shadowBlur=0;var q=m.innerShadow;if(q.blur>0){J.width=m.width+m.padding*2;J.height=m.height+m.padding*2;x.shadowBlur=q.blur;x.shadowColor=q.color;x.shadowOffsetX=0;x.shadowOffsetY=q.y;x.fillRect(-1*i,-100,3*i,100);x.shadowOffsetX=q.x;x.shadowOffsetY=0;x.fillRect(J.width,-1*k,100,3*k);x.shadowOffsetX=0;x.shadowOffsetY=q.y;x.fillRect(-1*i,J.height,3*i,100);x.shadowOffsetX=q.x;x.shadowOffsetY=0;x.fillRect(-100,-1*k,100,3*k);y(g,a+l,a+d,i-a*2-n,k-a*2-c,j);g.clip();g.drawImage(J,0,0,J.width,J.height,a+l,a+d,J.width,J.height)}};PIXI.InputObject=function(a){this.tabIndex=a!==K?a:PIXI.InputObject.tabIndex++;PIXI.Sprite.call(this,PIXI.Texture.fromCanvas(this.canvas));PIXI.InputObject.inputs.push(this);this.resolution=1;if(!w){if(!PIXI.InputObject.hiddenInput){var b=document.createElement("input");b.type="text";b.tabindex=-1;b.style.position="fixed";b.style.opacity=0;b.style.pointerEvents="none";b.style.left="0px";b.style.bottom="0px";b.style.left="-100px";b.style.top="-100px";b.style.zIndex=10;b.addEventListener("blur",function(){if(PIXI.InputObject.currentInput){PIXI.InputObject.currentInput.onMouseUpOutside()}},false);b.addEventListener("keydown",function(c){if(PIXI.InputObject.currentInput){c=c||window.event;if(PIXI.InputObject.currentInput.data.hasFocus){PIXI.InputObject.currentInput.onKeyDown(c)}}});b.addEventListener("keyup",function(c){if(PIXI.InputObject.currentInput){c=c||window.event;if(PIXI.InputObject.currentInput.data.hasFocus){PIXI.InputObject.currentInput.onKeyUp(c)}}});document.body.appendChild(b);PIXI.InputObject.textProp=O(b);PIXI.InputObject.hiddenInput=b}this.hiddenInput=PIXI.InputObject.hiddenInput}this._textNeedsUpdate=true;this.data.dirty=true;this.update()};PIXI.InputObject.prototype=Object.create(PIXI.Sprite.prototype);PIXI.InputObject.prototype.constructor=PIXI.InputObject;z(PIXI.InputObject.prototype,{updateData:function(a){if(a.hasOwnProperty("text")){this._textStyleNeedsUpdate=true}this.data=z(a,this.data);this.data.dirty=true;if(a.hasOwnProperty("value")||this._textStyleNeedsUpdate){this._textNeedsUpdate=true}},focus:function(){if(PIXI.InputObject.currentInput===this){return}if(PIXI.InputObject.currentInput){PIXI.InputObject.currentInput.blur()}PIXI.InputObject.currentInput=this;this.data.hasFocus=true;this.data.onfocus();if(this.data.readonly){return}this.hiddenInput.focus()},blur:function(){if(PIXI.InputObject.currentInput===this){PIXI.InputObject.currentInput=null;this.data.hasFocus=false;this.hiddenInput.blur();this.data.onblur()}},onKeyUp:function(){},onKeyDown:function(){},onClick:function(){},onMouseMove:function(){},onMouseDown:function(){},onMouseUp:function(){},onMouseUpOutside:function(a){if(this.data.hasFocus&&!this.data.mouseDown){this.blur()}this.data.mouseDown=false},updateTexture:function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;if(H){this.requiresUpdate=true}else{this.texture.update()}},_renderWebGL:function(a){if(H){if(this.requiresUpdate){this.requiresUpdate=false;PIXI.updateWebGLTexture(this.texture.baseTexture,a.gl)}}else{this.resolution=a.resolution;this.texture.baseTexture.resolution=this.resolution}PIXI.Sprite.prototype._renderWebGL.call(this,a)},destroy:function(){this.interactive=false;this.context=null;this.canvas=null;this.texture.destroy(true);PIXI.InputObject.inputs.splice(PIXI.InputObject.inputs.indexOf(this),1)}},true);Object.defineProperty(PIXI.InputObject.prototype,"width",{get:function(){this.update();return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(PIXI.InputObject.prototype,"height",{get:function(){this.update();return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});PIXI.InputObject.tabIndex=0;PIXI.InputObject.currentCanvas=null;PIXI.InputObject.currentInput=null;PIXI.InputObject.hiddenInput=null;PIXI.InputObject.inputs=[];PIXI.InputObject.Styles={};PIXI.InputObject.TextCache={};PIXI.InputObject.textProp="value";PIXI.InputObject.Tab=function(c,d,a){c.preventDefault();if(PIXI.InputObject.inputs.length>1){var b=PIXI.InputObject.inputs.indexOf(a);while(true){if(++b>=PIXI.InputObject.inputs.length){b=0}if(PIXI.InputObject.inputs[b]===a){break}else{if(PIXI.InputObject.inputs[b].tabIndex!==-1){a.blur();setTimeout(function(){PIXI.InputObject.inputs[b].focus()},10);break}}}}};PIXI.InputObject.Style=function(a,c,b){if(c===K){return PIXI.InputObject.Styles[a]||{}}PIXI.InputObject.Styles[a]=c;if(b){delete PIXI.InputObject.Styles[a]}};PIXI.InputObject.blur=function(){if(PIXI.InputObject.currentInput&&!PIXI.InputObject.currentInput.data.mouseDown){PIXI.InputObject.currentInput.blur();PIXI.InputObject.currentInput=null}};window.addEventListener("blur",PIXI.InputObject.blur,false);PIXI.InputObject.setCanvas=function(a){if(!D){if(PIXI.InputObject.currentCanvas!==a){if(PIXI.InputObject.currentCanvas){PIXI.InputObject.currentCanvas.removeEventListener("mousedown",PIXI.InputObject.blur,true);PIXI.InputObject.currentCanvas.removeEventListener("touchstart",PIXI.InputObject.blur,true)}if(a){a.addEventListener("mousedown",PIXI.InputObject.blur,true);a.addEventListener("touchstart",PIXI.InputObject.blur,true)}PIXI.InputObject.currentCanvas=a}}};PIXI.InputObject.getTextCache=function(a,b){var d=a.textCache?a.textCache.__id:null;var c=a.data.text.font+"_"+a.data.text.strokeThickness;if(d){--PIXI.InputObject.TextCache[d].count;if(b){if(PIXI.InputObject.TextCache[d].count<=0){PIXI.InputObject.TextCache[d]=null}return}}if(!PIXI.InputObject.TextCache[c]){PIXI.InputObject.TextCache[c]={count:0,__id:c}}PIXI.InputObject.TextCache[c].count++;return PIXI.InputObject.TextCache[c]};PIXI.Input=function(a){this.data=a||{};if(this.data.style){this.data=z(this.data,PIXI.InputObject.Style(this.data.style))}this.data=z(this.data,E);this.data=z(this.data,C);this.data.selection=[0,0];this.data.clipPos=[0,0];this.data.cursorPos=0;this.cursorTimer=0;this.data.value=(this.data.value||this.data.placeholder||"")+"";this.currText=this.data.value;if(!this.data.text.bitmap){this.text=new PIXI.Text(this.data.value,this.data.text);this.textCache=PIXI.InputObject.getTextCache(this)}else{this.text=new PIXI.BitmapText(this.data.value||"Temp",this.data.text);this.text._isBitmapFont=true;this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale;if(!this.data.value){this._textNeedsUpdate=true}}this.cursor=new PIXI.Text("|",this.data.text);this.cursor.visible=false;this.selection=new PIXI.Sprite(G(this.data.selectionColor));this.data.height=this.data.height||A(this.text);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=this.data.width;this.canvas.height=this.data.height;PIXI.InputObject.call(this);this.addChild(this.selection);this.addChild(this.text);this.addChild(this.cursor);this.boundOnMouseUp=this.onMouseUp.bind(this);this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this);this.boundOnMouseDown=this.onMouseDown.bind(this);this.boundOnMouseMove=this.onMouseMove.bind(this);this.interactive=true;this.defaultCursor="text";this.buttonMode=true;this.mousemove=this.touchmove=this.boundOnMouseMove;this.mousedown=this.touchstart=this.boundOnMouseDown;this.mouseup=this.touchend=this.boundOnMouseUp;this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside};PIXI.Input.prototype=Object.create(PIXI.InputObject.prototype);PIXI.Input.prototype.constructor=PIXI.Input;z(PIXI.Input.prototype,{focus:function(){PIXI.InputObject.prototype.focus.call(this);if(this.data.readonly){return}if(w){this.value=prompt(this.data.placeholder||"Enter Text",this.value)||this.value;this._textNeedsUpdate=true;return}this.hiddenInput.type=this.data.type||"text";if(this.data.maxlength){this.hiddenInput.maxLength=this.data.maxlength}else{this.hiddenInput.removeAttribute("maxLength")}if(this.data.type==="number"){if(this.data.min!==K){this.hiddenInput.min=this.data.min}if(this.data.max!==K){this.hiddenInput.max=this.data.max}}else{this.hiddenInput.removeAttribute("min");this.hiddenInput.removeAttribute("max")}this.currText=this.value;this.data.value=this.currText;B(this.hiddenInput,PIXI.InputObject.textProp,this.currText);this._textNeedsUpdate=true},blur:function(a){a=a||this;PIXI.InputObject.prototype.blur.call(a);if(a.data.value===""){a.data.value=a.data.placeholder}a.clearSelection();this.cursor.visible=false;a._textNeedsUpdate=true},onKeyDown:function(f){this.data.selectionStart=-1;var b=f.which,a=f.shiftKey,e=null,d,c;if(f.which===27){this.blur();return}this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this.data.onkeydown(f,this);if(b===65&&(f.ctrlKey||f.metaKey)){f.preventDefault();this.data.selection[0]=0;this.data.selection[1]=this.value.length;this.hiddenInput.selectionStart=0;this.hiddenInput.selectionEnd=this.value.length;return}if(b===17||f.metaKey||f.ctrlKey){return}if(b===13){f.preventDefault();this.data.onsubmit(f,this)}else{if(b===9){PIXI.InputObject.Tab(f,b,this);return}}this.updateTextState()},onKeyUp:function(a){this.data.onkeyup(a,this);this.updateTextState()},updateTextState:function(){var a=P(this.hiddenInput,PIXI.InputObject.textProp);if(a!==this.data.value){this.data.value=a;this._textNeedsUpdate=true}if(this.data.selection[0]!==this.hiddenInput.selectionStart||this.data.selection[1]!==this.hiddenInput.selectionEnd){this.data.selection[0]=this.hiddenInput.selectionStart;this.data.selection[1]=this.hiddenInput.selectionEnd;this.data.cursorPos=this.data.selection[0];this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this._cursorNeedsUpdate=true}},onMouseMove:function(d){if(!this.data.hasFocus||!this.data.mouseDown||this.data.selectionStart<0||!this.stage.data.interactionManager.hitTest(this,d)){return}var b=this.mousePos(d);var e=this.clickPos(b.x,b.y),a=Math.min(this.data.selectionStart,e),c=Math.max(this.data.selectionStart,e);if(this.data.selection[0]!==a||this.data.selection[1]!==c){this.data.selection[0]=a;this.data.selection[1]=c;if(!w){this.hiddenInput.selectionStart=a;this.hiddenInput.selectionEnd=c}this.data.cursorPos=e;this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this._cursorNeedsUpdate=true}},onMouseDown:function(a){if(a.data.originalEvent.which===2||a.data.originalEvent.which===3){a.originalEvent.preventDefault();return}this.focus();var b=this.mousePos(a);this.data.mouseDown=true;if(this.data.value===this.data.placeholder){this._textNeedsUpdate=true}this.data.selectionStart=this.clickPos(b.x,b.y);this.data.selection[0]=this.data.selectionStart;this.data.selection[1]=this.data.selectionStart;if(!w){this.hiddenInput.selectionStart=this.data.selectionStart;this.hiddenInput.selectionEnd=this.data.selectionStart}this.data.cursorPos=this.data.selectionStart;this._cursorNeedsUpdate=true;this._selectionNeedsUpdate=true},onMouseUp:function(c){if(c.data.originalEvent.which===2||c.data.originalEvent.which===3){c.originalEvent.preventDefault();return}var b=this.mousePos(c);var a=this.clickPos(b.x,b.y);if(!(this.data.selectionStart>=0&&a!==this.data.selectionStart)){this.data.cursorPos=a;this.data.selection[0]=this.data.cursorPos;this.data.selection[1]=this.data.cursorPos;if(!w){this.hiddenInput.selectionStart=this.data.cursorPos;this.hiddenInput.selectionEnd=this.data.cursorPos}this._cursorNeedsUpdate=true}this.data.selectionStart=-1;this.data.mouseDown=false},update:function(a){if(a||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate||this._selectionNeedsUpdate){if(this.data.dirty){this.renderTexture();this.data.dirty=false}if(this._textStyleNeedsUpdate){this.text.setStyle(this.data.text);this.cursor.setStyle(this.data.text);this.cursor.updateText();if(!this.text._isBitmapFont){this.textCache=PIXI.InputObject.getTextCache(this)}else{this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this._textStyleNeedsUpdate=false}if(this._textNeedsUpdate){this.currText=this.clipText();this.text.setText(this.currText||"");this.text.updateText();this._textNeedsUpdate=false}if(this._selectionNeedsUpdate){this.updateSelection();this._selectionNeedsUpdate=false}}},updateSelection:function(){if(this.data.selection[0]!==this.data.selection[1]){this.selection.visible=true;this.selection.x=(this.selection.y+this.textWidth(this.currText.substring(0,this.data.selection[0]-this.data.clipPos[0])))|0;this.selection.width=Math.ceil(this.textWidth(this.currText.substring(this.data.selection[0]-this.data.clipPos[0],this.data.selection[1]-this.data.clipPos[0])))+this.text.style.strokeThickness}else{this.selection.visible=false}},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data);if(this.data.valign==="none"||!this.data.valign){this.text.y=this.data.padding|0}else{if(this.data.valign==="middle"){this.text.y=(this.data.textboxTop+((this.data.textboxHeight-this.text.height)/2))|0}else{if(this.data.valign==="top"){this.text.y=this.data.textboxTop|0}else{if(this.data.valign==="bottom"){this.text.y=(this.data.textboxTop+this.data.textboxHeight-this.text.height)|0}}}}this.cursor.y=this.text.y;this.data.placeholderAlign=this.data.placeholderAlign||this.data.align;this.text.x=(this.data.textboxLeft+this.data.padding)|0;var a=(this.data.padding+this.data.borderWidth+this.data.shadowTop)|0;this.selection.y=a;this.selection.height=this.data.height;this._cursorNeedsUpdate=true;this._selectionNeedsUpdate=true;this.updateTexture()},clipText:function(a){var d=a===K,g=0;a=d?(this.data.mouseDown||this.data.hasFocus?this.value:(this.data.value||this.data.placeholder||"")):a;if(this.data.type==="password"&&a!==this.data.placeholder){a=a.replace(/./g,"*")}var c=this.textWidth(a),i=a.length,f=(this.data.width-2*this.data.padding),b=a;if(d&&a!==this.data.placeholder){this.data.cursorPos=this.data.cursorPos||0;if(i<this.data.clipPos[0]){this.data.clipPos[0]=0}if(this.data.cursorPos>this.data.clipPos[1]){g=this.data.clipPos[0];a=a.substr(g,this.data.cursorPos-this.data.clipPos[0])||""}else{if(this.data.cursorPos<this.data.clipPos[0]){g=this.data.cursorPos;a=a.substr(g)||""}else{g=this.data.clipPos[0];a=a.substr(g)}}if(a!==b){c=this.textWidth(a),i=a.length}}if(c>f){if(!this.text._isBitmapFont){var h=this.textCache,e="";while(c>f){if(d&&this.data.cursorPos>this.data.clipPos[1]){e=a[0];h[e]=h[e]||this.textWidth(e);c-=h[e];a=a.substr(1,--i);g++}else{e=a[--i];h[e]=h[e]||this.textWidth(e);c-=h[e];a=a.substr(0,i)}}}else{while(c>f){if(d&&this.data.cursorPos>this.data.clipPos[1]){c-=this.textWidth(a[0]);a=a.substr(1,--i);g++}else{c-=this.textWidth(a[--i]);a=a.substr(0,i)}}}}if(d&&a!==this.data.placeholder){this.data.clipPos[0]=g;this.data.clipPos[1]=g+i}return a+""},clickPos:function(e,c){var f=this.currText,b=0,d=f.length;if(e<this.textWidth(f)){for(var a=0;a<f.length;a++){b+=this.textWidth(f[a]);if(b>=e){d=a;break}}}return this.data.clipPos[0]+d},textWidth:function(d){if(!this.text._isBitmapFont){var b=this.context;b.font=this.text.style.font;b.textAlign="left";return b.measureText(d||"").width}else{var f=null;var a=0;var h=this.text._data;for(var e=0;e<d.length;e++){var c=d.charCodeAt(e);var g=h.chars[c];if(!g){continue}if(f&&g.kerning[f]){a+=g.kerning[f]}a+=g.xAdvance;f=c}return a*this.text._scale}},mousePos:function(a){return a.data.getLocalPosition(a.target||this)},clearSelection:function(){if(this.data.selection[1]!==this.data.selection[0]){this.data.cursorPos=0;this.data.selection[0]=0;this.data.selection[1]=0;if(!w){this.hiddenInput.selectionStart=0;this.hiddenInput.selectionEnd=0}this._cursorNeedsUpdate=true;this._selectionNeedsUpdate=true}},updateTransform:function(){this.update();if(this.data.hasFocus||this.data.mouseDown){var a=Date.now();if((a-this.cursorTimer)>=F){this.cursorTimer=a;this.cursor.visible=!this.cursor.visible}if(this.selection.visible){this.cursor.visible=false}if(this.cursor.visible&&this._cursorNeedsUpdate){this.cursor.x=(this.selection.y-1+this.textWidth(this.currText.substring(0,this.data.cursorPos-this.data.clipPos[0])))|0;this._cursorNeedsUpdate=false}}else{this.selection.visible=false;this.cursor.visible=false}PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){if(!this.text._isBitmapFont){PIXI.InputObject.getTextCache(this,true);this.text.destroy(true)}else{this.text=null}this.cursor.destroy(true);PIXI.InputObject.prototype.destroy.call(this)}},true);Object.defineProperty(PIXI.Input.prototype,"value",{get:function(){return this.data.value===this.data.placeholder?"":this.data.value},set:function(a){this.data.value=a+"";B(this.hiddenInput,PIXI.InputObject.textProp,a+"");this._textNeedsUpdate=true}});PIXI.Button=function(a){this.tabIndex=-1;this.data=a||{};if(this.data.style){this.data=z(this.data,PIXI.InputObject.Style(this.data.style))}this.data=z(this.data,E);this.data=z(this.data,C);if(!this.data.text.bitmap){this.text=new PIXI.Text(this.data.value,this.data.text)}else{this.text=new PIXI.BitmapText(this.data.value||"Temp",this.data.text);this.text._isBitmapFont=true;this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale;if(!this.data.value){this._textNeedsUpdate=true}}this.data.height=this.data.height||A(this.text);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=this.data.width;this.canvas.height=this.data.height;PIXI.InputObject.call(this,-1);this.addChild(this.text);this.boundOnMouseUp=this.onMouseUp.bind(this);this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this);this.boundOnMouseDown=this.onMouseDown.bind(this);this.interactive=true;this.buttonMode=true;this.mousedown=this.touchstart=this.boundOnMouseDown;this.mouseup=this.touchend=this.boundOnMouseUp;this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside};PIXI.Button.prototype=Object.create(PIXI.InputObject.prototype);PIXI.Button.prototype.constructor=PIXI.Button;z(PIXI.Button.prototype,{focus:function(){PIXI.InputObject.prototype.focus.call(this)},blur:function(a){PIXI.InputObject.prototype.blur.call(a||this)},onMouseDown:function(a){this.focus();this.data.mouseDown=true;this.data.onmousedown(a,this)},onMouseUp:function(a){this.data.onmouseup(a,this);this.data.mouseDown=false},update:function(a){if(a||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate){if(this.data.dirty){this.renderTexture();this.data.dirty=false}if(this._textStyleNeedsUpdate){this.text.setStyle(this.data.text);if(this.text._isBitmapFont){this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this._textStyleNeedsUpdate=false}if(this._textNeedsUpdate){this.text.setText(this.data.value||"");this.text.updateText();if(this.data.align==="center"){this.text.x=((this.data.outerWidth-this.text.width)/2)|0}else{if(this.data.align==="right"){this.text.x=(this.data.outerWidth-this.text.width-this.data.textboxLeft-this.data.padding)|0}}this._textNeedsUpdate=false}}},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data);if(this.data.valign==="none"||!this.data.valign){this.text.y=this.data.padding|0}else{if(this.data.valign==="middle"){this.text.y=(this.data.textboxTop+((this.data.textboxHeight-this.text.height)/2))|0}else{if(this.data.valign==="top"){this.text.y=this.data.textboxTop|0}else{if(this.data.valign==="bottom"){this.text.y=(this.data.textboxTop+this.data.textboxHeight-this.text.height)|0}}}}this.text.x=(this.data.textboxLeft+this.data.padding)|0;this.updateTexture()},updateTransform:function(){this.update();PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){if(this.text._isBitmapFont){this.text.destroy(true)}else{this.text=null}PIXI.InputObject.prototype.destroy.call(this)}},true);Object.defineProperty(PIXI.Button.prototype,"value",{get:function(){return this.data.value},set:function(a){this.data.value=a+"";this._textNeedsUpdate=true}});PIXI.Select=function(a){this.data=a||{};if(this.data.style){this.data=z(this.data,PIXI.InputObject.Style(this.data.style))}this.data=z(this.data,E);this.data=z(this.data,C);this.data.options=this.data.options||{};this.data.selected=this.data.selected||null;this.selectedIndex=0;this.lineHeight=20;this.options=[];if(!this.data.text.bitmap){this.text=new PIXI.Text("",this.data.text)}else{this.text=new PIXI.BitmapText("Temp",this.data.text);this.text._isBitmapFont=true;this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this.selection=new PIXI.Sprite(G(this.data.selectionColor));this.selection.visible=false;this.menu=new PIXI.Sprite(G(this.data.backgroundColor));this.menu.visible=false;this.data.height=this.data.height||A(this.text);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=this.data.width;this.canvas.height=this.data.height;PIXI.InputObject.call(this);this.addChild(this.text);this.addChild(this.menu);this.addChild(this.selection);this.boundOnMouseUp=this.onMouseUp.bind(this);this.boundOnMouseUpOutside=this.onMouseUpOutside.bind(this);this.boundOnMouseDown=this.onMouseDown.bind(this);this.interactive=true;this.mousedown=this.touchstart=this.boundOnMouseDown;this.mouseup=this.touchend=this.boundOnMouseUp;this.mouseupoutside=this.touchendoutside=this.boundOnMouseUpOutside;var c="";for(var b in this.data.options){if(this.data.selected===b){this.selectedIndex=this.options.length}this.options.push({value:b,text:this.data.options[b]});c+=this.data.options[b]+"\n"}if(!this.data.optionText||!this.data.optionText.bitmap){this.optionstext=new PIXI.Text(c,this.data.optionText||{font:"14px arial"});this.lineHeight=(this.optionstext.height/(this.options.length+1)-this.optionstext.style.strokeThickness/2)|0}else{this.optionstext=new PIXI.BitmapText(c,this.data.optionText);this.optionstext._isBitmapFont=true;this.optionstext._data=PIXI.BitmapText.fonts[this.optionstext.fontName];this.optionstext._scale=this.optionstext.fontSize/this.optionstext._data.size;this.optionstext._lineHeight=this.optionstext._data.lineHeight*this.optionstext._scale;this.lineHeight=this.optionstext._lineHeight}this.optionstext.visible=false;this.addChild(this.optionstext);this.menu.height=this.lineHeight*this.options.length-1;this.menu.interactive=true;this.menu.mousedown=this.menu.touchstart=function(d){if(d.data.originalEvent.which===2||d.data.originalEvent.which===3){d.originalEvent.preventDefault();this.displayMenu(false);return}this.selectedIndex=this.getIndexByLocalPosition(d);this.updateText()}.bind(this);this.menu.mousemove=this.menu.touchmove=function(d){if(this.menu.stage&&this.menu.stage.interactionManager.hitTest(this.menu,d)){this.menu.selectedIndex=this.getIndexByLocalPosition(d);this.updateSelection(this.menu.selectedIndex)}}.bind(this);this.updateText()};PIXI.Select.prototype=Object.create(PIXI.InputObject.prototype);PIXI.Select.prototype.constructor=PIXI.Select;z(PIXI.Select.prototype,{getIndexByLocalPosition:function(a){var c=a.data.getLocalPosition(this).y-this.menu.startY;if(c<1||c>this.menu.height){return}var b=Math.floor(c/(this.lineHeight+1));if(b<0){b=0}else{if(b>=this.options.length){b=this.options.length-1}}return b},updateText:function(){var a=this.value;if(a){if(this.data.value!==a.text){this.data.value=a.text}this._textNeedsUpdate=true;this.updateSelection()}else{this.data.value=""}},updateSelection:function(a){this.selection.y=this.menu.startY+this.lineHeight*(a!==K?a:this.selectedIndex)},focus:function(){PIXI.InputObject.prototype.focus.call(this)},blur:function(a){a=a||this;PIXI.InputObject.prototype.blur.call(a);a.displayMenu(false)},onKeyDown:function(f){var b=f.which,a=f.shiftKey,e=null,d,c;if(f.which===27){this.blur();return}this._textNeedsUpdate=true;this._selectionNeedsUpdate=true;this.data.onkeydown(f,this);if(b===32||b===13){f.preventDefault();if(this.menu.visible){this.displayMenu(false);if(this.menu.selectedIndex){this.selectedIndex=this.menu.selectedIndex;this.menu.selectedIndex=null;this.updateText()}}else{this.displayMenu(true)}return}if(b===9){PIXI.InputObject.Tab(f,b,this);return}if(b===38){this.selectedIndex--;if(this.selectedIndex<0){this.selectedIndex=0}this.updateText()}if(b===40){this.selectedIndex++;if(this.selectedIndex>=this.options.length){this.selectedIndex=this.options.length-1}this.updateText()}},onKeyUp:function(a){this.data.onkeyup(a,this);if(!this.menu.selectedIndex){this.updateText()}},onMouseDown:function(a){this.focus();this.data.mouseDown=true;this.data.onmousedown(a,this)},onMouseUp:function(a){this.data.onmouseup(a,this);this.data.mouseDown=false;this.focus();this.displayMenu(!this.menu.visible)},displayMenu:function(a){this.menu.visible=a;this.selection.visible=false;this.optionstext.visible=false;if(!a){return}this.menu.x=this.data.textboxLeft;this.menu.width=this.data.textboxWidth;this.selection.x=this.data.textboxLeft;this.selection.width=this.data.textboxWidth;this.selection.height=this.lineHeight;var b=this.stage?this.stage.interactionManager.target.height:0;var c=this.y-this.height*this.anchor.y;var d=b-(c+this.height);if(this.menu.height>d){if(c>d){this.menu.anchor.y=1;this.menu.y=1}else{this.menu.anchor.y=0;this.menu.y=this.height-1}}else{this.menu.anchor.y=0;this.menu.y=this.height-1}this.menu.startY=this.menu.y-this.menu.height*this.menu.anchor.y;this.menu.selectedIndex=null;this.optionstext.y=this.menu.startY;this.optionstext.x=5;this.optionstext.visible=true;if(this.value){this.selection.visible=true;this.updateSelection()}},update:function(a){if(a||this.data.dirty||this._textNeedsUpdate||this._textStyleNeedsUpdate){if(this.data.dirty){this.renderTexture();this.data.dirty=false}if(this._textStyleNeedsUpdate){this.text.setStyle(this.data.text);if(this.text._isBitmapFont){this.text._data=PIXI.BitmapText.fonts[this.text.fontName];this.text._scale=this.text.fontSize/this.text._data.size;this.text._lineHeight=this.text._data.lineHeight*this.text._scale}this._textStyleNeedsUpdate=false}if(this._textNeedsUpdate){this.text.setText(this.data.value||"");this.text.updateText();this._textNeedsUpdate=false}}},renderTexture:function(){PIXI.ButtonFactory(this.canvas,this.context,this.data);PIXI.ButtonFactory(L,R,{backgroundGradient:["#bbb","#eee","#bbb"],borderWidth:1,borderColor:this.data.borderColor,borderRadius:[0,this.data.borderRadius,this.data.borderRadius,0],boxShadow:"none",innerShadow:"none",padding:0,width:25,height:this.data.outerHeight});R.beginPath();R.moveTo(9+this.data.borderWidth-2,this.data.outerHeight/3+this.data.borderWidth+1);R.lineTo(17-this.data.borderWidth,this.data.outerHeight/3+this.data.borderWidth+1);R.lineTo(12,2*this.data.outerHeight/3-this.data.borderWidth+2);R.closePath();R.fillStyle="#000";R.fill();this.context.drawImage(L,0,0,25,this.data.outerHeight,this.data.outerWidth-25,0,25,this.data.outerHeight);if(this.data.valign==="none"||!this.data.valign){this.text.y=this.data.padding|0}else{if(this.data.valign==="middle"){this.text.y=(this.data.textboxTop+((this.data.textboxHeight-this.text.height)/2))|0}else{if(this.data.valign==="top"){this.text.y=this.data.textboxTop|0}else{if(this.data.valign==="bottom"){this.text.y=(this.data.textboxTop+this.data.textboxHeight-this.text.height)|0}}}}this.text.x=(this.data.textboxLeft+this.data.padding)|0;this.updateTexture()},updateTransform:function(){this.update();PIXI.Sprite.prototype.updateTransform.call(this)},destroy:function(){if(!this.text._isBitmapFont){this.text.destroy(true)}else{this.text=null}if(!this.optionstext._isBitmapFont){this.optionstext._isBitmapFont.destroy(true)}else{this.optionstext=null}PIXI.InputObject.prototype.destroy.call(this)}},true);Object.defineProperty(PIXI.Select.prototype,"value",{get:function(){if(this.options[this.selectedIndex]){return this.options[this.selectedIndex]}return null},set:function(a){}})})();